(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0cc266"],{"4d66":function(t,e,i){"use strict";i.r(e);var n=i("7a23"),r=["src"],o=["src"],s=Object(n["l"])("div",{style:{height:"40px"}},null,-1);function a(t,e,i,a,c,u){var g=Object(n["M"])("n-space"),h=Object(n["M"])("n-layout");return Object(n["F"])(),Object(n["i"])(g,{vertical:"",size:"large",style:{height:"100vh",width:"100%"}},{default:Object(n["V"])((function(){return[Object(n["n"])(h,{position:"absolute",style:{width:"100%"}},{default:Object(n["V"])((function(){return[Object(n["n"])(g,{id:"displayArea",wrap:"false",style:{width:"100%"},align:"center",justify:"center",onClick:t.pageClick},{default:Object(n["V"])((function(){return[Object(n["l"])("img",{id:"imgBlockFirst",src:t.currentFirstImg},null,8,r),t.isDoublePage?(Object(n["F"])(),Object(n["k"])("img",{key:0,id:"imgBlockSecond",src:t.currentSecondImg},null,8,o)):Object(n["j"])("",!0)]})),_:1},8,["onClick"]),s]})),_:1})]})),_:1})}var c=i("1da1"),u=(i("96cf"),i("a9e3"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("e9c4"),i("99af"),i("d81d"),i("9ec0")),g=i("7317"),h=i("1157"),d=i.n(h),l=Object(n["o"])({setup:function(){var t=Object(u["a"])();Object(g["a"])();return{infoMessage:function(t){t.info(t,{duration:5e3})},handleStart:function(){t.start()},handleFinish:function(){t.finish()},handleError:function(){t.error()}}},props:{slected_page:{type:String,required:!0},book_id:{type:Number,required:!0}},data:function(){return{bookInfo:void 0,contentArray:void 0,isDoublePage:!1,preloadingArray:void 0,preloadingNumber:5,currentPosition:0,pageList:[],leftStatus:!1,rightStatus:!1,currentFirstImg:void 0,currentSecondImg:void 0,columns:1}},created:function(){var t=this;this.getBookInfo(),screen.width>screen.height?this.isDoublePage=!0:this.isDoublePage=!1,window.addEventListener("keydown",(function(e){"ArrowRight"==e.key?(t.next_page(),t.preloading(),t.loadingImg(),t.imgResize()):"ArrowLeft"==e.key&&(t.forward_page(),t.preloading(),t.loadingImg(),t.imgResize()),console.log(e.key)}))},methods:{loadingImg:function(){if(this.leftStatus||void 0===this.preloadingArray[this.currentPosition])setTimeout(this.loadingImg,100);else{var t=URL.createObjectURL(this.preloadingArray[this.currentPosition]);if(this.leftStatus=!0,this.currentFirstImg=t,this.currentPosition++,this.imgResize(),this.isDoublePage&&!this.rightStatus&&void 0!==this.preloadingArray[this.currentPosition]){var e=URL.createObjectURL(this.preloadingArray[this.currentPosition]);this.rightStatus=!0,this.currentSecondImg=e,this.currentPosition++,this.imgResize()}(!this.leftStatus||!this.rightStatus&&this.isDoublePage)&&setTimeout(this.loadingImg,100)}},getBookInfo:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:fetch("/api/info",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({book_id:t.book_id,token:"123456"})}).then((function(t){return t.json()})).then((function(e){return t.bookInfo=e})).then((function(){t.contentArray=t.bookInfo.content_info;for(var e=0;e<t.contentArray.length;e++)t.pageList=t.pageList.concat(t.contentArray[e].chapters);for(var i=0;i<t.pageList.length;i++)if(t.pageList[i].href==t.slected_page){t.currentPosition=i;break}t.preloadingArray=t.pageList.map((function(){})),t.preloading(),t.loadingImg()}));case 1:case"end":return e.stop()}}),e)})))()},preloading:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var i,n,r,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(i=t.currentPosition-2<0?0:t.currentPosition-2,n=t.pageList.length-1,n=t.isDoublePage?t.currentPosition+3<t.pageList.length?t.currentPosition+3:t.pageList.length-1:t.currentPosition+2<t.pageList.length?t.currentPosition+2:t.pageList.length-1,r=0;r<t.preloadingArray.length;r++)(r>n||r<i)&&(t.preloadingArray[r]=void 0);for(o=function(e){void 0===t.preloadingArray[e]&&(fetch("/api/content",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({book_id:t.book_id,href:t.pageList[e].href,token:"123456"})}).then((function(t){return t.blob()})).then((function(i){return t.preloadingArray[e]=i})),setTimeout(t.preloading,100))},s=i;s<=n;s++)o(s);case 6:case"end":return e.stop()}}),e)})))()},imgResize:function(){var t=d()("#route_viewer").width();this.isDoublePage?(d()("#imgBlockFirst").css("width",t/2*.85),d()("#imgBlockSecond").css("width",t/2*.85)):d()("#imgBlockFirst").css("width",.85*t)},pageClick:function(t){var e=d()("#displayArea").width()-(screen.width-t.clientX),i=d()("#displayArea").width()-(screen.height-t.clientY),n=e/d()("#displayArea").width(),r=i/d()("#displayArea").width();n>=.66||n>=.33&&r>=.66?(this.next_page(),this.preloading(),this.loadingImg(),this.imgResize()):(n<.33||n<.66&&r<.33)&&(this.forward_page(),this.preloading(),this.loadingImg(),this.imgResize())},next_page:function(){this.currentPosition>=this.preloadingArray.length-2&&this.infoMessage("没有更多了哦～"),this.leftStatus=!1,this.rightStatus=!1},forward_page:function(){console.log(this.currentPosition),this.isDoublePage&&this.currentPosition>=4?(console.log(this.currentPosition),this.currentPosition-=4):this.currentPosition>=2&&!this.isDoublePage&&(this.currentPosition-=2),this.leftStatus=!1,this.rightStatus=!1}}}),p=i("6b0d"),f=i.n(p);const b=f()(l,[["render",a]]);e["default"]=b}}]);
//# sourceMappingURL=chunk-2d0cc266.e3c59b55.js.map