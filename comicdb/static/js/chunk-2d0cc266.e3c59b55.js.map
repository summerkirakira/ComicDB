{"version":3,"sources":["webpack:///./src/views/ImageComicReader.vue","webpack:///./src/views/ImageComicReader.vue?24b8"],"names":["style","vertical","size","position","id","wrap","align","justify","pageClick","src","currentFirstImg","isDoublePage","currentSecondImg","setup","loadingBar","infoMessage","message","info","duration","handleStart","start","handleFinish","finish","handleError","error","props","slected_page","type","String","required","book_id","Number","data","bookInfo","undefined","contentArray","preloadingArray","preloadingNumber","currentPosition","pageList","leftStatus","rightStatus","columns","created","this","getBookInfo","screen","width","height","window","addEventListener","e","key","next_page","preloading","loadingImg","imgResize","forward_page","console","log","methods","setTimeout","objectURL","URL","createObjectURL","fetch","method","headers","body","JSON","stringify","token","then","response","json","content_info","i","length","concat","chapters","href","map","pre_start","pre_end","blob","displayWidth","css","event","distanceToDisplayWidth","clientX","distanceToDisplayHeight","clientY","clickPositionRatioLeft","clickPositionRatioTop","__exports__","render"],"mappings":"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","file":"js/chunk-2d0cc266.e3c59b55.js","sourcesContent":["<template>\n  <n-space vertical size=\"large\" style=\"height: 100vh; width: 100%\">\n    <n-layout position=\"absolute\" style=\"width: 100%\">\n      <n-space\n        id=\"displayArea\"\n        wrap=\"false\"\n        style=\"width: 100%\"\n        align=\"center\"\n        justify=\"center\"\n        @click=\"pageClick\"\n      >\n        <img id=\"imgBlockFirst\" :src=\"currentFirstImg\" />\n        <img id=\"imgBlockSecond\" v-if=\"isDoublePage\" :src=\"currentSecondImg\" />\n      </n-space>\n      <div style=\"height: 40px\"/>\n    </n-layout>\n  </n-space>\n</template>\n<script>\nimport { defineComponent } from \"vue\";\nimport { useLoadingBar, useMessage } from \"naive-ui\";\nimport $ from \"jquery\";\n\nexport default defineComponent({\n  setup() {\n    const loadingBar = useLoadingBar();\n    const message = useMessage();\n    return {\n      infoMessage(message) {\n        message.info(\n          message,\n          { duration: 5000 }\n        );\n      },\n      handleStart() {\n        loadingBar.start();\n      },\n      handleFinish() {\n        loadingBar.finish();\n      },\n      handleError() {\n        loadingBar.error();\n      },\n    };\n  },\n  props: {\n    slected_page: {\n      type: String,\n      required: true,\n    },\n    book_id: {\n      type: Number,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      bookInfo: undefined,\n      contentArray: undefined,\n      isDoublePage: false,\n      preloadingArray: undefined,\n      preloadingNumber: 5,\n      currentPosition: 0,\n      pageList: [],\n      leftStatus: false,\n      rightStatus: false,\n      currentFirstImg: undefined,\n      currentSecondImg: undefined,\n      columns: 1,\n    };\n  },\n  created() {\n    this.getBookInfo();\n    screen.width > screen.height?this.isDoublePage=true:this.isDoublePage=false\n     window.addEventListener('keydown', (e) => {\n         if(e.key == 'ArrowRight') {\n            this.next_page()\n            this.preloading()\n            this.loadingImg()\n            this.imgResize()\n         } else if (e.key == 'ArrowLeft') {\n            this.forward_page()\n            this.preloading()\n            this.loadingImg()\n            this.imgResize()\n         }\n      console.log(e.key)\n    });\n  },\n  methods: {\n    loadingImg() {\n      if (\n        !this.leftStatus &&\n        this.preloadingArray[this.currentPosition] !== undefined\n      ) {\n        // console.log('1111')\n        let objectURL = URL.createObjectURL(\n          this.preloadingArray[this.currentPosition]\n        );\n        this.leftStatus = true;\n        this.currentFirstImg = objectURL;\n        this.currentPosition++;\n        this.imgResize();\n      } else {\n        setTimeout(this.loadingImg, 100);\n        return;\n      }\n      if (\n        this.isDoublePage &&\n        !this.rightStatus &&\n        this.preloadingArray[this.currentPosition] !== undefined\n      ) {\n        let objectURL = URL.createObjectURL(\n          this.preloadingArray[this.currentPosition]\n        );\n        this.rightStatus = true;\n        this.currentSecondImg = objectURL;\n        this.currentPosition++;\n        this.imgResize();\n      }\n      if (!this.leftStatus || (!this.rightStatus && this.isDoublePage)) {\n        setTimeout(this.loadingImg, 100);\n      }\n    },\n    async getBookInfo() {\n      fetch(\"/api/info\", {\n        method: \"post\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ book_id: this.book_id, token: \"123456\" }),\n      })\n        .then((response) => response.json())\n        .then((data) => (this.bookInfo = data))\n        .then(() => {\n          this.contentArray = this.bookInfo.content_info;\n        //   console.log(this.contentArray);\n          for (let i = 0; i < this.contentArray.length; i++) {\n            this.pageList = this.pageList.concat(this.contentArray[i].chapters);\n          }\n          for (let i = 0; i < this.pageList.length; i++) {\n            // console.log(this.slected_page);\n            if (this.pageList[i].href == this.slected_page) {\n              this.currentPosition = i;\n              break;\n            }\n          }\n          this.preloadingArray = this.pageList.map(() => undefined);\n        //   console.log(this.preloadingArray)\n          this.preloading();\n          this.loadingImg();\n        });\n    },\n    async preloading() {\n      let pre_start =\n        this.currentPosition - 2 < 0 ? 0 : this.currentPosition - 2;\n      let pre_end = this.pageList.length - 1;\n      if (this.isDoublePage) {\n        pre_end =\n          this.currentPosition + 3 < this.pageList.length\n            ? this.currentPosition + 3\n            : this.pageList.length - 1;\n      } else {\n        pre_end =\n          this.currentPosition + 2 < this.pageList.length\n            ? this.currentPosition + 2\n            : this.pageList.length - 1;\n      }\n      for(let i=0; i< this.preloadingArray.length; i++) {\n        if(i > pre_end || i < pre_start) {\n          this.preloadingArray[i] = undefined\n        }\n      }\n    //   console.log(pre_start + '----' + pre_end)\n      for (let i = pre_start; i <= pre_end; i++) {\n        if (this.preloadingArray[i] === undefined) {\n          fetch(\"/api/content\", {\n            method: \"post\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              book_id: this.book_id,\n              href: this.pageList[i].href,\n              token: \"123456\",\n            }),\n          })\n            .then((response) => response.blob())\n            .then((blob) => (this.preloadingArray[i] = blob))\n            // .then(() => console.log(this.preloadingArray))\n          setTimeout(this.preloading, 100);\n        }\n      }\n    },\n    imgResize() {\n      // let displayHeight = $(\"#route_viewer\").height()\n      let displayWidth = $(\"#route_viewer\").width();\n      // // console.log(displayWidth + '-' + displayHeight)\n      // let leftHeightRatio = $(\"#imgBlockFirst\").height() / displayHeight\n      // let leftWidthRatio = $(\"#imgBlockFirst\").width() * 2 / displayWidth\n      // let leftScaleRatio = leftHeightRatio > leftWidthRatio?leftWidthRatio:leftHeightRatio\n      // if(this.isDoublePage){\n      //     console.log($(\"#imgBlockSecond\").height())\n      //     let RightHeightRatio = $(\"#imgBlockSecond\").height() / displayHeight\n      //     let RightWidthRatio = $(\"#imgBlockSecond\").width() / displayWidth\n      //     let RightScaleRatio = RightHeightRatio > RightWidthRatio?RightWidthRatio:RightHeightRatio\n      //     $(\"#imgBlockSecond\").css(\"width\", $(\"#imgBlockSecond\").width * RightScaleRatio)\n      // }\n      // console.log(leftScaleRatio)\n      // $(\"#imgBlockFirst\").css(\"width\", $(\"#imgBlockFirst\").width * leftScaleRatio)\n      if(this.isDoublePage){\n      $(\"#imgBlockFirst\").css(\"width\", (displayWidth / 2) * 0.85);\n      $(\"#imgBlockSecond\").css(\"width\", (displayWidth / 2) * 0.85);\n      } else {\n          $(\"#imgBlockFirst\").css(\"width\",displayWidth * 0.85);\n      }\n    },\n    pageClick(event) {\n        let distanceToDisplayWidth = $(\"#displayArea\").width() - (screen.width - event.clientX)\n        let distanceToDisplayHeight = $(\"#displayArea\").width() - (screen.height - event.clientY)\n        let clickPositionRatioLeft = distanceToDisplayWidth / $(\"#displayArea\").width()\n        let clickPositionRatioTop = distanceToDisplayHeight / $(\"#displayArea\").width()\n        if(clickPositionRatioLeft >= 0.66 || (clickPositionRatioLeft >= 0.33 && clickPositionRatioTop >= 0.66)) {\n            // console.log('NextPage')\n            this.next_page()\n            this.preloading()\n            this.loadingImg()\n            this.imgResize()\n        } else if(clickPositionRatioLeft<0.33 || (clickPositionRatioLeft < 0.66 && clickPositionRatioTop < 0.33)) {\n            // console.log('ForwardPage')\n            this.forward_page()\n            this.preloading()\n            this.loadingImg()\n            this.imgResize()\n        }\n    },\n    next_page() {\n        if(this.currentPosition >= this.preloadingArray.length - 2){\n          this.infoMessage('没有更多了哦～')\n        }\n        this.leftStatus = false\n        this.rightStatus = false\n    },\n    forward_page() {\n        console.log(this.currentPosition)\n        if(this.isDoublePage && this.currentPosition >= 4) {\n            console.log(this.currentPosition)\n            this.currentPosition -= 4\n        } else if (this.currentPosition >= 2 && !this.isDoublePage){\n            this.currentPosition -= 2\n        }\n        this.leftStatus = false\n        this.rightStatus = false\n    }\n  },\n});\n</script>\n","import { render } from \"./ImageComicReader.vue?vue&type=template&id=3878e8af\"\nimport script from \"./ImageComicReader.vue?vue&type=script&lang=js\"\nexport * from \"./ImageComicReader.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/forever/Documents/Java Script/comicdb/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}